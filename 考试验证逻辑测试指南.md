# 考试验证逻辑测试指南

## 测试目标
验证考试验证逻辑的修改是否正确工作，确保在各种验证失败场景下能正确显示错误信息。

## 测试环境
- WPF应用程序已启动
- 数据库已初始化
- 管理员用户已登录

## 测试步骤

### 1. 准备测试数据

#### 1.1 创建学生用户
1. 以管理员身份登录系统
2. 进入"用户管理"模块
3. 创建一个学生用户（如果不存在）
   - 用户名：student1
   - 密码：123456
   - 角色：学生

#### 1.2 创建测试试卷
1. 进入"试卷管理"模块
2. 创建以下几种类型的试卷用于测试：

**试卷A - 正常可考试卷**
- 标题：正常考试试卷
- 状态：已发布
- 开始时间：当前时间之前
- 结束时间：当前时间之后
- 允许重考：是

**试卷B - 未发布试卷**
- 标题：未发布试卷
- 状态：未发布
- 开始时间：当前时间之前
- 结束时间：当前时间之后

**试卷C - 考试时间未到**
- 标题：考试时间未到试卷
- 状态：已发布
- 开始时间：当前时间之后1小时
- 结束时间：当前时间之后2小时

**试卷D - 考试已结束**
- 标题：考试已结束试卷
- 状态：已发布
- 开始时间：当前时间之前2小时
- 结束时间：当前时间之前1小时

**试卷E - 不允许重考且已考过**
- 标题：不允许重考试卷
- 状态：已发布
- 开始时间：当前时间之前
- 结束时间：当前时间之后
- 允许重考：否
- 需要先让学生考过一次

### 2. 测试验证逻辑

#### 2.1 测试正常场景
1. 以学生身份登录（student1/123456）
2. 进入"考试列表"
3. 点击"正常考试试卷"的"开始考试"按钮
4. **预期结果**：应该能正常进入考试界面

#### 2.2 测试未发布试卷
1. 确保"未发布试卷"在考试列表中不显示
2. **预期结果**：未发布的试卷不应该出现在学生的考试列表中

#### 2.3 测试考试时间未到
1. 如果"考试时间未到试卷"显示在列表中，点击"开始考试"
2. **预期结果**：应该显示错误消息"考试尚未开始，请等待考试开始时间"

#### 2.4 测试考试已结束
1. 如果"考试已结束试卷"显示在列表中，点击"开始考试"
2. **预期结果**：应该显示错误消息"考试已结束，无法参加"

#### 2.5 测试不允许重考
1. 先让学生完成"不允许重考试卷"的考试
2. 再次尝试点击该试卷的"开始考试"按钮
3. **预期结果**：应该显示错误消息"您已参加过此考试，不允许重复考试"

#### 2.6 测试不存在的试卷（需要手动模拟）
这个场景需要通过修改数据库或代码来模拟，正常情况下不会出现。

## 验证要点

### 1. 错误消息显示
- 错误消息应该清晰明确
- 错误消息应该以弹窗形式显示
- 错误消息显示后不应该进入考试界面

### 2. 用户体验
- 验证失败时应该有明确的提示
- 不应该出现空白或无响应的情况
- 错误提示应该用户友好

### 3. 系统稳定性
- 验证失败不应该导致程序崩溃
- 验证过程应该快速响应
- 多次验证失败不应该影响系统性能

## 测试记录

请在测试过程中记录以下信息：

| 测试场景 | 操作步骤 | 预期结果 | 实际结果 | 是否通过 | 备注 |
|---------|---------|---------|---------|---------|------|
| 正常考试 | 点击正常试卷开始考试 | 进入考试界面 |  |  |  |
| 未发布试卷 | 查看考试列表 | 不显示未发布试卷 |  |  |  |
| 考试时间未到 | 点击未开始试卷 | 显示时间未到错误 |  |  |  |
| 考试已结束 | 点击已结束试卷 | 显示考试结束错误 |  |  |  |
| 不允许重考 | 重复参加考试 | 显示不允许重考错误 |  |  |  |

## 代码修改验证

本次修改涉及以下文件：
1. `ExamSystem.Services/Models/ExamValidationResult.cs` - 新增验证结果模型
2. `ExamSystem.Services/Services/ExamService.cs` - 新增详细验证方法
3. `ExamSystem.Services/Interfaces/IExamService.cs` - 新增接口方法
4. `ExamSystem.WPF/ViewModels/StudentExamListViewModel.cs` - 修改开始考试逻辑
5. `ExamSystem.WPF/ViewModels/FullScreenExamViewModel.cs` - 修改加载考试数据逻辑

所有修改都已完成并集成到系统中。

## 注意事项

1. 测试前请确保数据库中有足够的测试数据
2. 测试过程中注意观察日志文件中的错误信息
3. 如果发现问题，请记录详细的错误信息和重现步骤
4. 测试完成后可以清理测试数据

## 测试完成标准

- [ ] 所有验证场景都能正确显示错误信息
- [ ] 错误信息内容准确且用户友好
- [ ] 验证失败时不会进入考试界面
- [ ] 系统在各种验证场景下都保持稳定
- [ ] 正常考试流程不受影响