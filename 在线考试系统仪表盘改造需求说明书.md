# 在线考试系统仪表盘改造需求说明书

## 一、背景与目标
- 背景：当前系统不同角色登录后，仪表盘数据个性化不足，影响使用效率与决策支持。
- 目标：
  - 为管理员、教师、学生分别提供贴合职责的关键数据与快捷入口。
  - 统一统计口径与数据定义，避免歧义。
  - 支持后续扩展（图表、过滤、分页、权限控制）。

## 二、角色与使用场景
- 管理员（Admin）：关注系统整体运行、用户活跃、试卷与考试质量、消息公告效果、异常监控。
- 教师（Teacher）：关注个人题库与试卷、考试执行与成绩表现、待批阅、教学提醒。
- 学生（Student）：关注可参加与即将进行的考试、个人成绩与学习进度、系统/老师通知。

## 三、关键指标与统计口径
- 题库数：管理员=全局总数；教师=本人创建的题库数。
- 题目数：管理员=全局总数；教师=本人题库内题目数。
- 试卷数：管理员=全局总数；教师=本人创建的试卷数。
- 可参加考试数（学生）：满足已发布、当前时间在参加窗口内、对该学生开放的考试数。
- 已完成考试数（学生）：状态为已完成/已评分的记录数。
- 平均分（默认近30天）：管理员=系统全局；教师=教师名下试卷的记录；学生=个人记录。
- 通过率（默认近30天）：管理员=全局完成考试中通过比例；教师=教师名下试卷完成考试通过比例；学生=个人完成考试通过比例。
- 即将进行的考试（学生）：未来7天内开始的可参加考试（或处于发布且激活状态）。
- 待批阅数（教师）：需人工评分且未评分的答题记录数。
- 活跃用户数（管理员）：近7天登录过的用户数。
- 消息/通知：按角色范围分别返回（公告、评分提醒、考试安排等）。

## 四、仪表盘内容设计（按角色）
### 1) 管理员仪表盘
- 顶部KPI卡：用户总数/活跃用户数（7天）、试卷总数/发布中试卷数、考试记录总数（近30天新增）、系统通过率（近30天）。
- 趋势与榜单：
  - 近30天考试场次趋势、平均分/通过率趋势。
  - 热门试卷榜单（参加人数/通过率）。
- 质量与合规：异常事件统计（登录失败、提交失败、评分失败），数据健康提示（如试卷缺少合格线）。
- 消息中心：最近公告（标题、发布时间、范围），阅读率/未读数。
- 快捷操作：新建用户、试卷、发布公告、导出报表。

### 2) 教师仪表盘
- 顶部KPI卡（个性化）：我的题库/题目数、我的试卷/发布中试卷数、待批阅记录数、我的平均分/通过率（近30天）。
- 活动与任务：即将进行的考试（名称、开始时间、预计人数）、待批阅队列（试卷、未评分数、最迟提交时间）。
- 成绩与质量：我的试卷表现概览（平均分、通过率、完成率）、高错题/区分度异常提示。
- 消息中心：与我相关的通知（考试安排、评分提醒）。
- 快捷操作：新建题库、试卷、发布考试、批量导入题目。

### 3) 学生仪表盘
- 顶部概览：可参加考试数、已完成考试数、我的平均分/通过率（近30天）。
- 近期安排：即将进行的考试（名称、开始时间、时长、合格线、是否允许重考）、可参加考试列表（支持筛选）。
- 学习反馈：最近成绩（最近5次：总分、是否通过、提交时间/百分位）、能力标签（题型/知识点正确率简要反馈）。
- 消息中心：考试通知、成绩发布提醒。
- 快捷操作：开始考试、查看结果与解析、错题回顾（若允许）。

## 五、数据模型与接口（与现有服务层对齐）
- 服务接口：
  - Admin：GetAdminDashboardAsync(userId) → AdminDashboardData
  - Teacher：GetTeacherDashboardAsync(userId) → TeacherDashboardData（Summary按教师个人范围统计）
  - Student：GetStudentDashboardAsync(userId) → StudentDashboardData（Summary按学生个人范围统计）
- 建议数据模型增补：
  - DashboardSummary：QuestionBankCount、QuestionCount、ExamPaperCount、（管理员）ExamRecordCount；
    - 教师/学生可替换为更适合的统计，如我的考试记录数/已完成考试数。
  - AdminDashboardData：UserStatistics（TotalUsers, ActiveUsers7d）、ExamPaperStatistics（TotalPapers, PublishedPapers）、RecentNotifications、Trends（ExamSessions30d, AvgScoreTrend30d, PassRateTrend30d）、HotPapers、SystemAnomalies。
  - TeacherDashboardData：Summary（MyBankCount, MyQuestionCount, MyPaperCount, MyAvgScore30d, MyPassRate30d）、UpcomingExams、PendingGradings、PaperPerformance、RelevantNotifications。
  - StudentDashboardData：AvailableExams、CompletedExams、MyAvgScore30d、MyPassRate30d、UpcomingExams、RecentScores、PersonalNotifications。
- 统计通用规则：
  - 时间窗口默认为近30天（可配置）；发布中试卷=IsPublished=true且IsActive=true；
  - 可参加考试需匹配学生范围与时间窗；待批阅限定需人工评分题型；
  - 平均分与通过率排除取消/未提交记录。

## 六、前端交互与体验（WPF）
- 信息层级：顶部4-6张KPI卡；中部趋势/任务区域；底部消息中心与近期列表。
- 交互：KPI卡点击跳转对应模块；列表分页与排序（默认时间降序）；基础筛选（时间范围、状态、归属）。
- 空状态与异常：无数据友好提示与引导；统计失败提供重试与日志入口。

## 七、权限与安全
- 角色隔离：严格按UserRole返回对应数据集，避免跨角色数据泄露。
- 数据域限制：教师仅能查看本人数据；学生仅能查看个人考试与成绩。
- 空值与导航属性安全：对可空字段与导航属性进行安全访问与Include加载。

## 八、性能与维护
- 数据加载：仪表盘主数据一次性聚合返回；趋势/榜单数据可延迟或后台加载。
- 缓存：管理员全局统计可短期缓存（1-5分钟）；教师/学生个性化统计按需即时计算或轻量缓存。
- 分页：列表默认pageSize=10；趋势数据默认30条以内。

## 九、验收标准与测试
- 三角色登录后仪表盘数据差异化明显（示例：教师题库数≠管理员题库总数）。
- 学生“可参加/即将进行考试”过滤正确；教师“待批阅”识别准确。
- 管理员趋势与热门试卷榜单显示正确，支持排序与时间范围切换。
- 消息中心按角色范围显示，未读数量准确。
- 空状态与异常场景无崩溃、无空引用错误；性能：主内容1秒内加载完成。

## 十、开发改造建议
- Services层：确保三角色接口各自按口径计算Summary与列表；避免教师/学生使用全局Summary；增加趋势与榜单DTO。
- Repositories层：新增教师名下范围查询、学生可参加考试过滤；对可空字段（Analysis、Description、StartTime等）加安全判断。
- WPF前端：DashboardViewModel根据角色切换数据源与模板；DashboardView.xaml按角色展示模块；实现KPI卡跳转、列表分页与排序。
- 测试：构造三角色样例数据进行验证；执行冒烟与性能测试。

## 十一、后续扩展（可选）
- 学生学习建议与智能推荐；教师教学质量分析（区分度、知识点掌握度）。
- 管理员安全审计面板（异常行为时间线）；导出报表与自定义统计视图。