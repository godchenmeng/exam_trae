一、权限矩阵与现有实现的对齐

- 管理员
  - 模块：用户管理、系统配置、日志审计（现有模块名已包含 UserManagement、SystemSettings、ViewLogs）
  - 操作：创建/编辑/删除用户（CreateUser/UpdateUser/DeleteUser）、分配/调整角色（UpdateUser）、重置密码（ResetPassword）、导入/导出用户（ImportUsers/ExportUsers）、锁定/解锁（LockUser/UnlockUser）、查看所有用户（ViewAllUsers）、系统参数设置（SystemSettings）、查看系统日志（ViewLogs）
- 老师
  - 模块：题库管理、试卷管理、考试管理、统计报表、消息通知
  - 操作：题库管理（Create/Update/DeleteQuestionBank、ViewQuestionBank）、题目管理（Create/Update/DeleteQuestion、ViewQuestion）、试卷创建与发布（Create/Update/DeleteExamPaper、PublishExamPaper、ViewExamPaper）、考试管理（StartExam/StopExam/MonitorExam）、批改试卷（GradeExam）、统计报表（ViewStatistics/ExportStatistics）、消息通知（需要新增：SendNotification）
- 考生
  - 模块：考试中心、成绩查询、学习资源、消息中心
  - 操作：参加考试（TakeExam，已存在）、查看个人成绩（ViewOwnGrades，已存在）、下载资源（需要新增：DownloadResource / ViewResource）、查看系统通知（需要新增：ViewNotification/ReceiveNotification）
二、建议新增的权限点与模块名
为满足“消息通知、学习资源、消息中心”等需求，建议在 PermissionService 中扩展以下操作与模块名称：

- 新增操作
  - SendNotification（老师、管理员）
  - ViewNotification（老师、考生、管理员）
  - ReceiveNotification（考生）
  - UploadResource（老师、管理员）
  - ManageResource（老师、管理员）
  - ViewResource（老师、考生、管理员）
  - DownloadResource（考生、老师）
- 新增模块
  - MessageCenter（老师、考生、管理员）
  - LearningResources（老师、考生、管理员）
注：现有 PermissionService 使用字符串操作名与模块名进行判断。为降低误拼写风险，后续可以引入静态常量类 PermissionKeys/ModuleKeys 管理这些字符串。

三、UI 导航与模块入口设计（MainWindow）

- 目标：登录后根据用户角色动态显示对应模块 Tab/菜单。避免“不可访问模块可见但不可用”的困惑。
- 学生可见
  - 考试中心（ExamManagement）
  - 成绩查询（GradeManagement 中针对 ViewOwnGrades 的视图或独立 Tab）
  - 学习资源（LearningResources）
  - 消息中心（MessageCenter）
- 老师可见
  - 题库管理（QuestionBankManagement）
  - 试卷管理（ExamPaperManagement）
  - 考试管理（ExamManagement）
  - 统计报表（StatisticsReports）
  - 消息通知（MessageCenter：老师使用发送视图）
- 管理员可见
  - 用户管理（UserManagement）
  - 系统配置（SystemSettings）
  - 日志审计（LogsAudit：可作为独立 Tab 或系统工具页）
- 落地方式
  - 使用 IPermissionService.HasModuleAccess(UserRole, moduleName) 在 MainWindow 的 TabItem 级别控制 Visibility/启用状态。
  - 可选：在 MainWindowViewModel 维护一个根据角色生成的 Module 列表，绑定到 UI，避免散落的可见性绑定。
四、消息通知与学习资源模块的数据与服务设计

- 领域模型
  - Notification
    - Id、Title、Content、SenderId、Scope（TargetRole/TargetUserIds）、CreatedAt、Priority、Status
  - NotificationRecipient
    - Id、NotificationId、ReceiverId、DeliveredAt、ReadAt、DeliveryStatus（Pending/Delivered/Read/Failed）
  - LearningResource
    - Id、Title、Description、FilePath/StorageUri、OriginalFileName、CategoryId、UploaderId、CreatedAt、IsActive、DownloadCount、FileSize
  - ResourceCategory
    - Id、Name、Description、SortOrder、IsActive
- 仓储与服务
  - INotificationService
    - SendAsync(NotificationCreateDto)
    - GetUserNotificationsAsync(userId, filters)
    - MarkAsReadAsync(notificationId, userId)
  - IResourceService
    - UploadAsync(ResourceUploadDto)
    - ListAsync(ResourceQuery)
    - DownloadAsync(resourceId, userId)
    - ManageAsync（上下架、类别管理等）
- WPF 视图与交互
  - 老师端：NotificationSendView（选择目标群体：全部考生/指定班级/指定用户；支持草稿/预览）
  - 学生端：MessageCenterView（列表+详情，已读/未读状态，支持一键标记已读）
  - 老师端：ResourceUploadView（标题、描述、分类、文件选择、上传；资源列表管理）
  - 学生端：ResourceCenterView（资源列表、分类筛选、下载按钮与下载进度）
  - 样式与交互
    - 统一使用 CommonStyles 既有的 PrimaryButton、ModernTextBox、Card、DialogTitleStyle 等，保持视觉一致性
    - 列表应支持分页与搜索，避免一次性加载过多数据
五、权限校验的双环节保障

- 服务层保障
  - 所有对外服务（例如 NotificationService、ResourceService）在方法入口通过 IPermissionService.HasPermission 校验角色的执行权限
  - 记录重要操作日志（Serilog 已配置，可补充日志上下文，如用户ID、角色、操作名、结果）
- UI 层保障
  - 根据 HasModuleAccess 决定模块入口是否显示
  - 操作按钮（如“发布试卷”“发送通知”“上传资源”）在命令 CanExecute 中进行权限判断，防止通过异常导航进入页面后错误操作
六、实施步骤与里程碑（建议顺序）

- 第1步：权限服务扩展
  - 在 IPermissionService/PermissionService 中增加上述操作与模块名的判断
  - 引入 PermissionKeys/ModuleKeys 静态常量类（可选，但推荐）
- 第2步：UI 导航权限控制
  - MainWindow 的 TabItem/菜单根据角色生成，或绑定 HasModuleAccess 进行 Visibility 控制
  - 学生端/老师端/管理员端的默认首页设置（例如学生默认进入“考试中心”）
- 第3步：消息通知模块骨架
  - 领域模型与 EF 映射、仓储接口与实现、NotificationService
  - 老师发送视图、学生查看视图的基础页面与交互
- 第4步：学习资源模块骨架
  - 领域模型与 EF 映射、仓储接口与实现、ResourceService
  - 老师上传/管理视图、学生下载视图的基础页面与交互
- 第5步：考试中心与成绩查询入口完善
  - 面向学生的导航与页内权限校验，联通现有 ExamPaper/ExamRecord 功能
- 第6步：统计报表与日志审计入口（占位页）
  - 老师/管理员入口打通，后续逐步完善报表数据与日志界面
- 第7步：端到端自测
  - 三类角色的登录、模块可见性、操作权限、异常处理与日志记录
  - 验收标准见下文
七、验收标准（样例）

- 登录后模块可见性
  - 学生仅能看到“考试中心、成绩查询、学习资源、消息中心”
  - 老师仅能看到“题库管理、试卷管理、考试管理、统计报表、消息通知”
  - 管理员仅能看到“用户管理、系统配置、日志审计”
- 操作权限
  - 学生无法点击“发布试卷”“发送通知”“上传资源”等按钮（不可见或禁用）
  - 老师可以发送通知与上传资源，管理员可以查看系统日志与修改系统参数
- 服务层拦截
  - 任何越权调用在服务层返回失败并记录日志
- 消息与资源
  - 老师发送的通知，学生可在消息中心收到并标记已读
  - 老师上传的资源，学生可在学习资源中看到并下载，下载记录计数增加
八、技术注意事项与建议

- 目标框架与包版本
  - 当前 net5.0-windows 下使用部分 Microsoft.Extensions.* 8.x 包会产生大量警告，建议尽快升级到 net6.0-windows 或更高版本以获得兼容性与长期支持
- 常量化权限键值
  - 将字符串权限与模块名集中常量化，降低维护成本与误拼写风险
- 数据存储
  - 学习资源文件建议以文件系统存储为主（数据库仅存元数据），注意文件路径安全与访问控制
- 日志审计
  - 关键权限变更与敏感操作（如用户管理、试卷发布、资源管理）务必记录详细审计日志，便于管理员查询
九、需要你确认的细节

- 消息通知的目标范围是否支持“按班级/按用户组”？如果现有数据模型未区分班级，需要确认“分组”的来源
- 学习资源的存储方式（本地文件存储路径/云存储/数据库二进制），以及是否需要下载权限控制（例如仅限参加某考试的考生）
- 管理员的“系统配置”具体包含哪些系统参数（例如考试时间策略、密码策略、文件大小限制等）
- 统计报表的维度与导出格式（Excel/CSV/PDF）