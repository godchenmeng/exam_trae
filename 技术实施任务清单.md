技术实施任务清单（基于《模块需求.md》）
日期：2025-10-19

总体目标
- 基于管理员、老师、考生三类角色的产品需求，分解为可执行的开发任务，覆盖权限、UI导航、消息通知、学习资源、考试与成绩、统计报表与日志审计、端到端测试，以及非功能性优化。
- 所有任务在现有架构（Domain/Infrastructure/Services/WPF UI）内完成，并与 IPermissionService/PermissionService 对齐。

任务编号 T1：权限服务扩展（RBAC 对齐）
- 目标：在 IPermissionService/PermissionService 中新增操作与模块名，支持消息通知与学习资源；降低字符串误拼风险。
- 子任务：
  1) 新增常量类 PermissionKeys/ModuleKeys，集中管理操作名与模块名（SendNotification、ViewNotification、ReceiveNotification、UploadResource、ManageResource、ViewResource、DownloadResource；MessageCenter、LearningResources）。
  2) 扩展 PermissionService.HasPermission/HasModuleAccess/GetUserPermissions/GetUserModules，覆盖新增操作与模块。
  3) 在 Services 层编写单元测试，验证三类角色的权限矩阵（包含新增点）。
  4) 更新开发文档（README/模块需求），说明操作名与模块名的使用规范。
- 验收标准：三类角色权限判断与模块访问判定准确；单元测试覆盖新增权限点并全部通过；日志记录包含角色、操作、结果。
- 依赖：无（直接在 Services 层实现）。
- 优先级：高。

任务编号 T2：UI 导航与模块入口控制（MainWindow 动态模块）
- 目标：登录后根据角色动态显示 Tab/菜单；设置各角色默认首页；按钮与命令层进行权限校验。
- 子任务：
  1) 为 MainWindowViewModel 增加根据角色生成模块列表的方法；或在 XAML 中绑定 HasModuleAccess 控制可见性。
  2) 配置学生默认首页为“考试中心”，老师默认首页为“题库管理/考试管理”，管理员默认首页为“用户管理”。
  3) 在各页面命令 CanExecute 中增加 HasPermission 校验。
  4) 为 MessageCenter/LearningResources/LogsAudit 预留 Tab 占位（视图可后续补齐）。
- 验收标准：不同角色登录后仅看到自己模块；越权按钮不可见或禁用；默认首页正确。
- 依赖：T1。
- 优先级：高。

任务编号 T3：消息通知模块（老师发送、考生查看）
- 目标：实现消息通知的发送、接收、已读状态；老师端发送界面，考生端消息中心。
- 子任务（后端）：
  1) 领域实体：Notification（Id、Title、Content、SenderId、Scope、CreatedAt、Priority、Status），NotificationRecipient（Id、NotificationId、ReceiverId、DeliveredAt、ReadAt、DeliveryStatus）。
  2) EF 映射与迁移；仓储接口与实现；INotificationService：SendAsync、GetUserNotificationsAsync、MarkAsReadAsync。
  3) 服务入口权限校验（HasPermission：SendNotification/ViewNotification/ReceiveNotification）。
  4) Serilog 操作日志：发送、投递、标记已读。
- 子任务（前端/WPF）：
  1) 老师端 NotificationSendView + ViewModel（选择目标：全体考生/指定用户；标题、内容、优先级；草稿/预览）。
  2) 学生端 MessageCenterView + ViewModel（分页列表、状态筛选、详情查看、一键标记已读）。
  3) MainWindow 导航接入；样式沿用 CommonStyles 的 Card/PrimaryButton/ModernTextBox。
- 验收标准：老师可成功发送并在学生消息中心显示；已读状态更新；权限拦截有效；基本异常提示与日志完整。
- 依赖：T1、T2。
- 优先级：中。

任务编号 T4：学习资源模块（老师上传、考生下载）
- 目标：实现资源上传、分类管理、列表查看与下载；计数与权限控制。
- 子任务（后端）：
  1) 领域实体：LearningResource（Id、Title、Description、FilePath/StorageUri、OriginalFileName、CategoryId、UploaderId、CreatedAt、IsActive、DownloadCount、FileSize），ResourceCategory（Id、Name、Description、SortOrder、IsActive）。
  2) EF 映射与迁移；仓储接口与实现；IResourceService：UploadAsync、ListAsync、DownloadAsync、ManageAsync（上下架、类别管理）。
  3) 文件存储策略与配置（本地目录、文件大小限制、白名单后缀）。
  4) 权限校验（UploadResource/ManageResource/ViewResource/DownloadResource）与日志记录。
- 子任务（前端/WPF）：
  1) 老师端 ResourceUploadView + ViewModel（标题、描述、选择文件、选择分类、上传；资源列表管理）。
  2) 学生端 ResourceCenterView + ViewModel（列表、分类筛选、搜索、下载进度）。
  3) MainWindow 导航接入；统一样式与错误提示。
- 验收标准：老师能上传与管理资源；学生可浏览并下载，下载计数更新；越权操作拦截；异常与日志完整。
- 依赖：T1、T2。
- 优先级：中。

任务编号 T5：学生考试中心与成绩查询完善
- 目标：完善学生侧的考试流程入口与成绩列表展示，增强权限校验与导航体验。
- 子任务：
  1) 考试中心入口检查：调用 HasModuleAccess("ExamManagement")；仅学生显示。
  2) 成绩查询页：基于 ViewOwnGrades 展示个人成绩（分页、筛选、导出可选）。
  3) 与现有 ExamPaper/ExamRecord 服务对接，补齐必要的异常处理与日志记录。
- 验收标准：学生进入考试中心与成绩页正常；越权用户不可见或不可操作；日志记录完整。
- 依赖：T2。
- 优先级：中。

任务编号 T6：统计报表与日志审计入口（占位与基础）
- 目标：为老师/管理员提供报表与系统日志入口，占位页面可先行上线。
- 子任务：
  1) StatisticsView 扩展：按角色控制可见性；提供基本统计数据与导出（CSV/Excel）。
  2) LogsAuditView 新建：读取 Serilog 文件（Logs/），支持时间范围与关键字过滤；分页展示。
  3) 权限控制：ViewStatistics/ExportStatistics/ViewLogs；日志审计仅管理员可见。
- 验收标准：入口与基础视图可用；权限控制正确；日志文件读取性能可接受。
- 依赖：T1、T2。
- 优先级：低。

任务编号 T7：端到端自测与验收用例（三类角色）
- 目标：设计并执行 E2E 测试，覆盖登录、模块可见性、操作权限、异常与日志。
- 子任务：
  1) 学生用例：登录后模块可见（考试中心、成绩查询、学习资源、消息中心）；无法看到或执行老师/管理员操作；消息接收与标记已读；资源下载。
  2) 老师用例：题库/试卷/考试/统计可见；能发送通知、上传资源；不能访问系统配置与日志审计；越权尝试被拦截。
  3) 管理员用例：用户管理、系统配置、日志审计可见；不能参加考试与学生操作；日志查询可用。
  4) 验收标准：全部用例通过；关键动作有日志；异常提示可用。
- 依赖：T1-T6。
- 优先级：高。

任务编号 T8：非功能性优化（技术债与架构一致性）
- 目标：提升兼容性与质量，降低警告与维护成本。
- 子任务：
  1) 目标框架升级到 net6.0-windows（解决 Microsoft.Extensions.* 8.x 包的兼容警告）。
  2) 可空性警告清理：严格启用可空参考类型并逐步改造。
  3) 日志上下文完善：统一记录用户ID、角色、操作名、模块、结果、耗时。
  4) 权限键值常量化与文档化：统一引用，避免字符串散落。
- 验收标准：构建无严重警告；日志上下文一致；常量化完成。
- 依赖：无（与各任务并行）。
- 优先级：中。

交付物与排期建议
- 每个任务的交付物：代码提交（Domain/Infrastructure/Services/WPF）、迁移脚本/配置、使用说明、测试用例与报告、日志与异常策略说明。
- 排期建议（可并行）：
  1) Week 1：T1、T2（高优）
  2) Week 2：T3、T4（基础功能可用）
  3) Week 3：T5、T6（完善入口与占位）
  4) Week 4：T7、T8（验收与优化）

风险与待确认项
- 消息通知的目标范围是否支持按班级/按用户组（数据模型来源需确认）。
- 学习资源的存储位置与权限策略（本地目录/云存储、文件大小与类型约束）。
- 管理员系统配置项的具体范围（考试策略、密码策略、文件策略等）。
- 统计报表维度与导出格式（Excel/CSV/PDF）。

备注
- 本清单与《模块需求.md》保持一致，如产品侧有更新，请同步以便调整任务与排期。