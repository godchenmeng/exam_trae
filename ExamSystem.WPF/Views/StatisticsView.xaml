<UserControl x:Class="ExamSystem.WPF.Views.StatisticsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ExamSystem.WPF.Views"
             xmlns:vm="clr-namespace:ExamSystem.WPF.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1200">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Styles/CommonStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Background="{StaticResource BackgroundBrush}">
        <Grid.DataContext>
            <vm:StatisticsViewModel/>
        </Grid.DataContext>
        
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- æ ‡é¢˜æ  -->
        <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Padding="20,15">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="ðŸ“Š" FontSize="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock Text="ç»Ÿè®¡æŠ¥è¡¨" Style="{StaticResource TitleTextStyle}" Foreground="White"/>
            </StackPanel>
        </Border>

        <!-- ç­›é€‰å·¥å…·æ  -->
        <Border Grid.Row="1" Background="White" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1" Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- ç­›é€‰æ¡ä»¶ -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="è€ƒè¯•æ—¶é—´ï¼š" Style="{StaticResource BodyTextStyle}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <DatePicker x:Name="StartDatePicker" 
                                Width="120" 
                                Margin="0,0,10,0"/>
                    <TextBlock Text="è‡³" Style="{StaticResource BodyTextStyle}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <DatePicker x:Name="EndDatePicker" 
                                Width="120" 
                                Margin="0,0,20,0"/>
                    
                    <TextBlock Text="è¯•å·ï¼š" Style="{StaticResource BodyTextStyle}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <ComboBox x:Name="ExamPaperComboBox" 
                              Style="{StaticResource ModernComboBoxStyle}"
                              Width="200" 
                              Margin="0,0,20,0">
                        <ComboBoxItem Content="å…¨éƒ¨è¯•å·" IsSelected="True"/>
                    </ComboBox>
                    
                    <TextBlock Text="ç­çº§ï¼š" Style="{StaticResource BodyTextStyle}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <ComboBox x:Name="ClassComboBox" 
                              Style="{StaticResource ModernComboBoxStyle}"
                              Width="150" 
                              Margin="0,0,15,0">
                        <ComboBoxItem Content="å…¨éƒ¨ç­çº§" IsSelected="True"/>
                    </ComboBox>
                    
                    <Button x:Name="QueryButton" 
                            Style="{StaticResource PrimaryButtonStyle}"
                            Content="ðŸ” æŸ¥è¯¢" 
                            Click="QueryButton_Click"/>
                </StackPanel>

                <!-- å¯¼å‡ºæŒ‰é’® -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="ExportExcelButton" 
                            Style="{StaticResource SecondaryButtonStyle}"
                            Content="ðŸ“Š å¯¼å‡ºExcel" 
                            Margin="0,0,10,0"
                            Click="ExportExcelButton_Click"/>
                    <Button x:Name="ExportPdfButton" 
                            Style="{StaticResource SecondaryButtonStyle}"
                            Content="ðŸ“„ å¯¼å‡ºPDF" 
                            Click="ExportPdfButton_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ç»Ÿè®¡å†…å®¹ -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="20">
                
                <!-- æ¦‚è§ˆç»Ÿè®¡å¡ç‰‡ -->
                <TextBlock Text="ðŸ“ˆ è€ƒè¯•æ¦‚è§ˆ" Style="{StaticResource SubtitleTextStyle}" Margin="0,0,0,15"/>
                <UniformGrid Columns="4" Margin="0,0,0,30">
                    <!-- å‚è€ƒäººæ•° -->
                    <Border Style="{StaticResource CardStyle}" Margin="0,0,10,0">
                        <StackPanel>
                            <TextBlock Text="ðŸ‘¥" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                            <TextBlock x:Name="TotalStudentsTextBlock" Text="0" Style="{StaticResource TitleTextStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="å‚è€ƒäººæ•°" Style="{StaticResource BodyTextStyle}" HorizontalAlignment="Center" Foreground="{StaticResource SecondaryTextBrush}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- å¹³å‡åˆ† -->
                    <Border Style="{StaticResource CardStyle}" Margin="0,0,10,0">
                        <StackPanel>
                            <TextBlock Text="ðŸ“Š" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                            <TextBlock x:Name="AverageScoreTextBlock" Text="0.0" Style="{StaticResource TitleTextStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="å¹³å‡åˆ†" Style="{StaticResource BodyTextStyle}" HorizontalAlignment="Center" Foreground="{StaticResource SecondaryTextBrush}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- åŠæ ¼çŽ‡ -->
                    <Border Style="{StaticResource CardStyle}" Margin="0,0,10,0">
                        <StackPanel>
                            <TextBlock Text="âœ…" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                            <TextBlock x:Name="PassRateTextBlock" Text="0%" Style="{StaticResource TitleTextStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="åŠæ ¼çŽ‡" Style="{StaticResource BodyTextStyle}" HorizontalAlignment="Center" Foreground="{StaticResource SecondaryTextBrush}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- ä¼˜ç§€çŽ‡ -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="ðŸ†" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                            <TextBlock x:Name="ExcellentRateTextBlock" Text="0%" Style="{StaticResource TitleTextStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="ä¼˜ç§€çŽ‡" Style="{StaticResource BodyTextStyle}" HorizontalAlignment="Center" Foreground="{StaticResource SecondaryTextBrush}"/>
                        </StackPanel>
                    </Border>
                </UniformGrid>

                <!-- åˆ†æ•°åˆ†å¸ƒå›¾è¡¨ -->
                <TextBlock Text="ðŸ“Š åˆ†æ•°åˆ†å¸ƒ" Style="{StaticResource SubtitleTextStyle}" Margin="0,0,0,15"/>
                <Border Style="{StaticResource CardStyle}" Height="300" Margin="0,0,0,30">
                    <Grid>
                        <TextBlock Text="åˆ†æ•°åˆ†å¸ƒå›¾è¡¨åŒºåŸŸ" 
                                   Style="{StaticResource BodyTextStyle}" 
                                   HorizontalAlignment="Center" 
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource SecondaryTextBrush}"/>
                        <!-- TODO: é›†æˆå›¾è¡¨æŽ§ä»¶ -->
                    </Grid>
                </Border>

                <!-- é¢˜ç›®åˆ†æž -->
                <TextBlock Text="ðŸ” é¢˜ç›®åˆ†æž" Style="{StaticResource SubtitleTextStyle}" Margin="0,0,0,15"/>
                <Border Style="{StaticResource CardStyle}" Margin="0,0,0,30">
                    <DataGrid x:Name="QuestionAnalysisDataGrid" 
                              Style="{StaticResource ModernDataGridStyle}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              IsReadOnly="True"
                              MaxHeight="400">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="é¢˜ç›®ç¼–å·" Binding="{Binding QuestionNumber}" Width="80"/>
                            <DataGridTextColumn Header="é¢˜ç›®ç±»åž‹" Binding="{Binding QuestionType}" Width="100"/>
                            <DataGridTextColumn Header="é¢˜ç›®å†…å®¹" Binding="{Binding QuestionContent}" Width="300"/>
                            <DataGridTextColumn Header="æ­£ç¡®çŽ‡" Binding="{Binding CorrectRate}" Width="80"/>
                            <DataGridTextColumn Header="éš¾åº¦ç³»æ•°" Binding="{Binding DifficultyCoefficient}" Width="80"/>
                            <DataGridTextColumn Header="åŒºåˆ†åº¦" Binding="{Binding Discrimination}" Width="80"/>
                            
                            <DataGridTemplateColumn Header="éš¾åº¦ç­‰çº§" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding DifficultyColor}" 
                                                CornerRadius="10" 
                                                Padding="8,4">
                                            <TextBlock Text="{Binding DifficultyLevel}" 
                                                       Foreground="White" 
                                                       FontSize="11" 
                                                       HorizontalAlignment="Center"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>

                <!-- å­¦ç”Ÿæˆç»©æŽ’å -->
                <TextBlock Text="ðŸ… æˆç»©æŽ’å" Style="{StaticResource SubtitleTextStyle}" Margin="0,0,0,15"/>
                <Border Style="{StaticResource CardStyle}">
                    <DataGrid x:Name="StudentRankingDataGrid" 
                              Style="{StaticResource ModernDataGridStyle}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              IsReadOnly="True"
                              MaxHeight="400">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="æŽ’å" Binding="{Binding Rank}" Width="60"/>
                            <DataGridTextColumn Header="å­¦å·" Binding="{Binding StudentId}" Width="100"/>
                            <DataGridTextColumn Header="å§“å" Binding="{Binding StudentName}" Width="120"/>
                            <DataGridTextColumn Header="ç­çº§" Binding="{Binding ClassName}" Width="100"/>
                            <DataGridTextColumn Header="æ€»åˆ†" Binding="{Binding TotalScore}" Width="80"/>
                            <DataGridTextColumn Header="å®¢è§‚é¢˜å¾—åˆ†" Binding="{Binding ObjectiveScore}" Width="100"/>
                            <DataGridTextColumn Header="ä¸»è§‚é¢˜å¾—åˆ†" Binding="{Binding SubjectiveScore}" Width="100"/>
                            <DataGridTextColumn Header="è€ƒè¯•æ—¶é•¿" Binding="{Binding ExamDuration}" Width="100"/>
                            <DataGridTextColumn Header="æäº¤æ—¶é—´" Binding="{Binding SubmitTime, StringFormat=yyyy-MM-dd HH:mm}" Width="140"/>
                            
                            <DataGridTemplateColumn Header="ç­‰çº§" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding GradeColor}" 
                                                CornerRadius="10" 
                                                Padding="8,4">
                                            <TextBlock Text="{Binding Grade}" 
                                                       Foreground="White" 
                                                       FontSize="11" 
                                                       HorizontalAlignment="Center"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>