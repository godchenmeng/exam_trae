<Window x:Class="ExamSystem.WPF.Views.BuildingEditDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ExamSystem.WPF.Views"
        mc:Ignorable="d"
        Height="600" Width="900"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">

    <!-- æ ¹å…ƒç´ ä¸Šä¸èƒ½åœ¨è§£æžæ—¶ä½¿ç”¨ StaticResource å¼•ç”¨åŒçº§ Window.Resources ä¸­åŽå®šä¹‰çš„èµ„æºï¼Œ
         å› æ­¤æ”¹ä¸ºä½¿ç”¨å±žæ€§å…ƒç´ è¯­æ³•å¹¶å†…è”åˆ›å»ºè½¬æ¢å™¨å®žä¾‹ï¼Œé¿å… XamlParseExceptionã€‚ -->
    <Window.Title>
        <Binding Path="IsEditMode">
            <Binding.Converter>
                <local:BooleanToStringConverter />
            </Binding.Converter>
            <Binding.ConverterParameter>ç¼–è¾‘å»ºç­‘|æ·»åŠ å»ºç­‘</Binding.ConverterParameter>
        </Binding>
    </Window.Title>
    
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Styles/CommonStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <!-- å¸ƒå°”å€¼åˆ°å­—ç¬¦ä¸²è½¬æ¢å™¨ -->
            <local:BooleanToStringConverter x:Key="BooleanToStringConverter"/>
            
            <!-- éªŒè¯é”™è¯¯æ ·å¼ -->
            <Style x:Key="ValidationTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource ModernTextBoxStyle}">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding HasValidationErrors}" Value="True">
                        <Setter Property="BorderBrush" Value="#E74C3C"/>
                        <Setter Property="BorderThickness" Value="2"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Background="{StaticResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- æ ‡é¢˜æ  -->
        <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Padding="20,15">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding IsEditMode, Converter={StaticResource BooleanToStringConverter}, ConverterParameter='âœï¸|âž•'}" 
                           FontSize="20" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock Text="{Binding IsEditMode, Converter={StaticResource BooleanToStringConverter}, ConverterParameter='ç¼–è¾‘å»ºç­‘ä¿¡æ¯|æ·»åŠ æ–°å»ºç­‘'}" 
                           Style="{StaticResource TitleTextStyle}" 
                           Foreground="White"/>
            </StackPanel>
        </Border>

        <!-- è¡¨å•å†…å®¹ -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="30,20">
            <StackPanel>
                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <GroupBox Header="åŸºæœ¬ä¿¡æ¯" Style="{StaticResource ModernGroupBoxStyle}" Margin="0,0,0,20">
                    <Grid Margin="15">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- å»ºç­‘åç§° -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="å»ºç­‘åç§°*" Style="{StaticResource LabelTextStyle}"/>
                        <StackPanel Grid.Row="0" Grid.Column="1">
                            <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource ValidationTextBoxStyle}"
                                     MaxLength="100"/>
                            <TextBlock Text="{Binding ValidationErrors[Name]}" 
                                       Style="{StaticResource ErrorTextStyle}"
                                       Visibility="{Binding ValidationErrors[Name], Converter={StaticResource StringToVisibilityConverter}}"/>
                        </StackPanel>

                        <!-- åœ°å€ -->
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="åœ°å€*" Style="{StaticResource LabelTextStyle}" Margin="0,15,0,0"/>
                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,15,0,0">
                            <TextBox Text="{Binding Address, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource ValidationTextBoxStyle}"
                                     MaxLength="200"/>
                            <TextBlock Text="{Binding ValidationErrors[Address]}" 
                                       Style="{StaticResource ErrorTextStyle}"
                                       Visibility="{Binding ValidationErrors[Address], Converter={StaticResource StringToVisibilityConverter}}"/>
                        </StackPanel>

                        <!-- åŸŽå¸‚ -->
                        <TextBlock Grid.Row="2" Grid.Column="0" Text="åŸŽå¸‚*" Style="{StaticResource LabelTextStyle}" Margin="0,15,0,0"/>
                        <StackPanel Grid.Row="2" Grid.Column="1" Margin="0,15,0,0">
                            <ComboBox SelectedValue="{Binding City, UpdateSourceTrigger=PropertyChanged}"
                                      SelectedValuePath="Content"
                                      Style="{StaticResource ModernComboBoxStyle}">
                                <ComboBoxItem Content="è´µé˜³å¸‚"/>
                                <ComboBoxItem Content="éµä¹‰å¸‚"/>
                                <ComboBoxItem Content="å…­ç›˜æ°´å¸‚"/>
                                <ComboBoxItem Content="å®‰é¡ºå¸‚"/>
                                <ComboBoxItem Content="æ¯•èŠ‚å¸‚"/>
                                <ComboBoxItem Content="é“œä»å¸‚"/>
                                <ComboBoxItem Content="é»”å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·ž"/>
                                <ComboBoxItem Content="é»”ä¸œå—è‹—æ—ä¾—æ—è‡ªæ²»å·ž"/>
                                <ComboBoxItem Content="é»”è¥¿å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·ž"/>
                            </ComboBox>
                            <TextBlock Text="{Binding ValidationErrors[City]}" 
                                       Style="{StaticResource ErrorTextStyle}"
                                       Visibility="{Binding ValidationErrors[City], Converter={StaticResource StringToVisibilityConverter}}"/>
                        </StackPanel>

                        <!-- å»ºç­‘ç±»åž‹ -->
                        <TextBlock Grid.Row="3" Grid.Column="0" Text="å»ºç­‘ç±»åž‹*" Style="{StaticResource LabelTextStyle}" Margin="0,15,0,0"/>
                        <StackPanel Grid.Row="3" Grid.Column="1" Margin="0,15,0,0">
                            <ComboBox ItemsSource="{Binding BuildingTypeOptions}" 
                                      SelectedValue="{Binding BuildingType}"
                                      SelectedValuePath="Value"
                                      DisplayMemberPath="DisplayName"
                                      Style="{StaticResource ModernComboBoxStyle}"/>
                            <TextBlock Text="{Binding ValidationErrors[BuildingType]}" 
                                       Style="{StaticResource ErrorTextStyle}"
                                       Visibility="{Binding ValidationErrors[BuildingType], Converter={StaticResource StringToVisibilityConverter}}"/>
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <!-- ä½ç½®ä¿¡æ¯ -->
                <GroupBox Header="ä½ç½®ä¿¡æ¯" Style="{StaticResource ModernGroupBoxStyle}" Margin="0,0,0,20">
                    <Grid Margin="15">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- ç»åº¦ -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="ç»åº¦*" Style="{StaticResource LabelTextStyle}"/>
                        <StackPanel Grid.Row="0" Grid.Column="1">
                            <TextBox Text="{Binding Longitude, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource ValidationTextBoxStyle}"/>
                            <TextBlock Text="{Binding ValidationErrors[Longitude]}" 
                                       Style="{StaticResource ErrorTextStyle}"
                                       Visibility="{Binding ValidationErrors[Longitude], Converter={StaticResource StringToVisibilityConverter}}"/>
                        </StackPanel>

                        <!-- çº¬åº¦ -->
                        <TextBlock Grid.Row="0" Grid.Column="2" Text="çº¬åº¦*" Style="{StaticResource LabelTextStyle}" Margin="15,0,0,0"/>
                        <StackPanel Grid.Row="0" Grid.Column="3" Margin="15,0,0,0">
                            <TextBox Text="{Binding Latitude, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource ValidationTextBoxStyle}"/>
                            <TextBlock Text="{Binding ValidationErrors[Latitude]}" 
                                       Style="{StaticResource ErrorTextStyle}"
                                       Visibility="{Binding ValidationErrors[Latitude], Converter={StaticResource StringToVisibilityConverter}}"/>
                        </StackPanel>

                        <!-- åœ°å›¾é€‰æ‹©æŒ‰é’® -->
                        <Button Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4" 
                                Command="{Binding SelectLocationCommand}"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Content="ðŸ“ åœ¨åœ°å›¾ä¸Šé€‰æ‹©ä½ç½®" 
                                Margin="0,15,0,0"
                                HorizontalAlignment="Left"/>
                    </Grid>
                </GroupBox>

                <!-- æè¿°ä¿¡æ¯ -->
                <GroupBox Header="æè¿°ä¿¡æ¯" Style="{StaticResource ModernGroupBoxStyle}">
                    <Grid Margin="15">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="æè¿°" Style="{StaticResource LabelTextStyle}"/>
                        <StackPanel Grid.Row="1" Margin="0,10,0,0">
                            <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource ValidationTextBoxStyle}"
                                     MaxLength="500"
                                     Height="80"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"/>
                            <TextBlock Text="{Binding ValidationErrors[Description]}" 
                                       Style="{StaticResource ErrorTextStyle}"
                                       Visibility="{Binding ValidationErrors[Description], Converter={StaticResource StringToVisibilityConverter}}"/>
                        </StackPanel>
                    </Grid>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>

        <!-- çŠ¶æ€æ  -->
        <Border Grid.Row="2" Background="#F8F9FA" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0" Padding="20,10">
            <TextBlock Text="{Binding StatusMessage}" 
                       Style="{StaticResource BodyTextStyle}" 
                       Foreground="{StaticResource SecondaryTextBrush}"/>
        </Border>

        <!-- æŒ‰é’®æ  -->
        <Border Grid.Row="3" Background="White" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0" Padding="20,15">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Command="{Binding CancelCommand}" 
                        Style="{StaticResource SecondaryButtonStyle}"
                        Content="å–æ¶ˆ" 
                        Width="80" 
                        Margin="0,0,10,0"/>
                <Button Command="{Binding SaveCommand}" 
                        Style="{StaticResource PrimaryButtonStyle}"
                        Content="{Binding IsEditMode, Converter={StaticResource BooleanToStringConverter}, ConverterParameter='æ›´æ–°|ä¿å­˜'}" 
                        Width="80"
                        IsEnabled="{Binding IsSaving, Converter={StaticResource InverseBooleanConverter}}"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>