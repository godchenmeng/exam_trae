<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>WebView2 基础测试</title>
  <style>
    body { 
      margin: 0; 
      padding: 20px; 
      font-family: Arial, sans-serif; 
      background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
    }
    .container { 
      max-width: 800px; 
      margin: 0 auto; 
      background: white; 
      padding: 20px; 
      border-radius: 8px; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .status { 
      padding: 10px; 
      margin: 10px 0; 
      border-radius: 4px; 
      background: #e8f5e8; 
      border: 1px solid #4caf50; 
      color: #2e7d32;
    }
    button { 
      padding: 10px 20px; 
      margin: 5px; 
      border: none; 
      border-radius: 4px; 
      background: #007ACC; 
      color: white; 
      cursor: pointer; 
      font-size: 14px;
    }
    button:hover { background: #005a9e; }
    #info { 
      background: #f5f5f5; 
      padding: 15px; 
      border-radius: 4px; 
      margin: 10px 0; 
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>WebView2 基础功能测试</h1>
    
    <div class="status">
      ✅ HTML页面加载成功
    </div>
    
    <div id="info">
      <div>当前时间: <span id="time"></span></div>
      <div>用户代理: <span id="userAgent"></span></div>
      <div>页面URL: <span id="url"></span></div>
    </div>
    
    <div>
      <button onclick="testBasicJS()">测试JavaScript</button>
      <button onclick="testWebViewAPI()">测试WebView2 API</button>
      <button onclick="testExternalRequest()">测试外部请求</button>
    </div>
    
    <div id="results"></div>
  </div>

  <script>
    // 更新基本信息
    function updateInfo() {
      document.getElementById('time').textContent = new Date().toLocaleString();
      document.getElementById('userAgent').textContent = navigator.userAgent;
      document.getElementById('url').textContent = window.location.href;
    }
    
    function addResult(message, isError = false) {
      const div = document.createElement('div');
      div.style.padding = '8px';
      div.style.margin = '5px 0';
      div.style.borderRadius = '4px';
      div.style.background = isError ? '#ffebee' : '#e8f5e8';
      div.style.border = isError ? '1px solid #f44336' : '1px solid #4caf50';
      div.style.color = isError ? '#c62828' : '#2e7d32';
      div.textContent = message;
      document.getElementById('results').appendChild(div);
    }
    
    function testBasicJS() {
      try {
        const result = 2 + 2;
        addResult(`JavaScript基础功能正常: 2 + 2 = ${result}`);
      } catch (error) {
        addResult(`JavaScript错误: ${error.message}`, true);
      }
    }
    
    function testWebViewAPI() {
      try {
        if (window.chrome && window.chrome.webview) {
          window.chrome.webview.postMessage({
            type: 'test',
            message: 'WebView2 API测试消息',
            timestamp: new Date().toISOString()
          });
          addResult('WebView2 API可用，消息已发送');
        } else {
          addResult('WebView2 API不可用', true);
        }
      } catch (error) {
        addResult(`WebView2 API错误: ${error.message}`, true);
      }
    }
    
    function testExternalRequest() {
      try {
        fetch('https://api.github.com/zen')
          .then(response => response.text())
          .then(data => {
            addResult(`外部请求成功: ${data.substring(0, 50)}...`);
          })
          .catch(error => {
            addResult(`外部请求失败: ${error.message}`, true);
          });
      } catch (error) {
        addResult(`请求测试错误: ${error.message}`, true);
      }
    }
    
    // 页面加载完成
    document.addEventListener('DOMContentLoaded', function() {
      updateInfo();
      addResult('页面DOM加载完成');
      
      // 监听来自WPF的消息
      if (window.chrome && window.chrome.webview) {
        window.chrome.webview.addEventListener('message', function(event) {
          addResult(`收到WPF消息: ${JSON.stringify(event.data)}`);
        });
      }
    });
  </script>
</body>
</html>